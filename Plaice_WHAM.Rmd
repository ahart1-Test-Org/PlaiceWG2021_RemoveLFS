---
title: "Plaice_WHAM"
output: html_document
---

# Data
Data sourced from 2019 VPA update (2019_PLA_UNIT_MOD_VPA_T2018_NEC_ONLY.dat file from https://apps-nefsc.fisheries.noaa.gov/saw/sasi/sasi_report_options.php), manually converted to ASAP .dat format

## VPA only
PARAM: 39  11  30  17  10  1980  1  0  123456 
- unclear how this is used

Partial recruitment: 0.00  0.05  0.05  0.25  0.76  1.00  1.00  1.00  1.00  1.00
- presumably recruitment to fishery (ages 6-10 fully selected by fishery)

Stock estimate: 100  100  100  2000.  9000.  5000.  5000.  5000.  1000  500 
- presumably starting stock estimate

Stock min-max: 1.0000E+00  1.0000E+06

F-Plus: 1.00000*39 

Ages-F: 6-9

MFSpawn: 0.2500 0.2500

Checked Index: 1  2  3  4  5  6  7  8  9  11  12  13  14  15  16  17  18  

Checked Retro: 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  

Options: 1  0  0  1  1  1  0  1  0  5

Xparm: 80 1

## Ages
1-10
BUT catch at age/SSB, ect. has 11 age classes, in .dat I specified ages 1-11 since I am not sure I can specify 0-10

## Catch-at-age
5.200             98.870            1071.657          2671.500          3938.689          3933.315          3632.030          1185.400          1138.600          849.900           1380.400          
5.102             981.939           2192.097          5056.235          5338.265          3648.923          2401.297          1581.927          645.240           439.895           621.035           
9.603             603.238           3348.502          4574.705          4503.888          3599.226          3297.637          2037.990          1256.340          736.841           717.537           
14.549            662.791           1477.918          5174.310          4915.097          3910.459          2268.685          1271.281          700.767           449.300           910.792           
2.535             370.467           990.575           2422.061          6031.242          3244.447          1935.634          580.275           273.800           307.200           768.900           
64.773            157.827           1217.425          1336.409          2404.572          2872.048          2228.162          1081.289          438.072           267.117           181.945           
59.303            638.708           737.977           2283.971          1700.042          1476.463          1307.066          631.500           254.921           104.793           99.881            
38.475            589.615           1840.495          1439.239          2282.296          1336.913          895.036           542.855           187.158           61.618            59.941            
313.506           785.537           1839.531          1833.411          1597.373          1444.417          552.785           270.313           177.097           88.155            55.322            
15.339            2345.540          2713.335          2675.536          1588.668          863.641           857.347           552.118           196.193           103.646           118.323           
0.000             1074.370          4922.563          4022.551          2156.071          739.281           384.131           415.823           193.060           96.094            161.089           
0.359             240.424           1010.663          6134.169          4966.221          1275.039          328.661           166.829           202.817           97.590            104.748           
9.766             250.208           932.954           1856.278          6147.565          2681.691          862.332           190.760           131.194           117.592           93.470            
21.502            278.319           557.057           2209.636          2583.619          2654.356          1386.894          264.937           286.624           151.169           124.823           
58.064            883.988           409.310           1778.701          2937.310          1349.242          1160.219          597.926           235.098           149.911           290.923           
46.220            2565.414          1889.900          2744.648          3472.854          1913.556          660.821           594.435           210.732           52.663            49.724            
12.365            1291.766          1546.109          4118.275          2831.382          1548.134          581.875           244.008           127.342           37.440            69.732            
14.650            637.586           388.145           2596.844          3946.186          1780.725          639.622           182.330           85.013            66.355            116.291           
37.242            87.381            322.633           849.364           2715.772          2477.323          1066.818          318.888           59.612            56.885            154.820           
4.216             216.386           178.225           1192.760          1700.622          2415.365          1393.315          489.870           150.055           42.434            79.210            
2.744             308.557           509.593           955.654           1743.314          2273.680          1774.857          568.597           138.304           69.875            19.831            
0.000             93.206            467.597           1142.141          2437.005          2284.723          1609.012          921.546           296.462           56.676            53.374            
1.091             13.200            111.339           787.081           1467.924          1826.172          1199.927          519.901           285.239           162.587           178.374           
11.933            690.800           48.824            329.359           1327.427          1293.589          732.671           547.936           274.310           150.991           116.880           
6.071             138.584           223.825           440.715           938.285           1224.589          519.490           372.480           199.675           79.105            75.560            
34.472            285.778           110.118           464.302           1052.713          808.078           459.146           183.894           100.825           43.927            50.687            
28.533            87.682            131.434           534.035           822.902           563.144           367.413           195.471           100.621           61.187            43.927            
161.479           238.399           225.937           647.237           814.802           505.471           229.307           101.212           58.609            26.314            23.710            
14.543            55.235            144.298           538.769           897.972           576.452           349.365           185.209           93.093            89.446            60.899            
1.017             51.604            91.917            469.424           1023.152          1008.420          580.089           440.366           141.710           45.663            90.018            
0.000             495.562           424.970           514.218           740.691           1132.272          691.018           245.794           139.561           106.520           78.002            
5.010             192.180           141.393           196.117           412.989           883.282           868.727           483.356           127.176           69.578            51.194            
4.396             436.350           356.670           300.571           539.832           588.846           726.782           761.794           335.034           103.362           96.832            
0.359             27.219            158.563           302.988           385.830           584.849           379.431           456.393           364.247           181.415           82.947            
0.025             5.600             59.426            369.065           431.746           263.087           625.867           194.321           191.690           153.393           147.043           
0.068             18.999            153.628           383.361           463.278           340.486           260.875           345.851           112.781           145.227           139.935           
0.339             6.711             234.779           295.328           351.853           288.706           185.357           117.719           206.498           69.325            195.406           
0.0000            10.3230           42.4287           547.8231          439.0303          328.8005          235.0560          104.9701          110.5124          135.2888          152.1417          
26.3008           89.4509           198.3782          234.8177          636.2692          426.3195          309.0796          189.5918          130.9153          85.5820           200.9839  

## Weight-at-age
0.0300            0.0760            0.1542            0.2674            0.4089            0.6534            0.8286            1.0390            1.1830            1.3740            1.8953            
0.0315            0.1078            0.1685            0.3163            0.4417            0.7781            0.8850            0.9780            1.1300            1.2540            1.5509            
0.0180            0.1151            0.2297            0.2895            0.4180            0.5640            0.9601            1.1380            1.1960            1.5520            1.9014            
0.0134            0.0333            0.1849            0.3778            0.5303            0.6695            0.8231            1.0422            1.2381            1.4460            1.6797            
0.0041            0.0454            0.1609            0.3032            0.5241            0.6304            0.8880            1.1870            1.1330            1.3690            1.9579            
0.0175            0.0583            0.0836            0.2092            0.3312            0.5337            0.8473            1.1674            1.3770            1.6652            2.1279            
0.0159            0.0421            0.1384            0.2290            0.3840            0.5869            0.8421            1.1737            1.4914            1.7468            2.1944            
0.0128            0.0458            0.1307            0.2344            0.4093            0.6095            0.8924            1.1729            1.4834            1.7320            2.2838            
0.0159            0.0459            0.1590            0.2842            0.4486            0.6414            0.8800            1.2314            1.3965            1.7167            2.2384            
0.0090            0.0358            0.1033            0.2402            0.3578            0.4469            0.6886            0.7872            1.3252            1.4622            1.9243            
0.0065            0.0380            0.1230            0.2529            0.3904            0.5388            0.6993            0.8598            1.0880            1.3048            1.6959            
0.0040            0.0275            0.1116            0.3025            0.4437            0.6768            0.9577            1.1570            1.2738            1.5413            1.8127            
0.0060            0.0321            0.1155            0.3094            0.4908            0.7227            0.9150            1.2402            1.3187            1.6401            2.0065            
0.0030            0.0317            0.2190            0.3472            0.4759            0.6258            0.9431            1.2341            1.3939            1.5769            2.3134            
0.0040            0.0261            0.1883            0.3588            0.4560            0.6068            0.7940            1.0831            1.2891            1.4240            2.4242            
0.0061            0.0277            0.1256            0.2979            0.4805            0.6563            0.9012            1.1489            1.0996            2.1050            1.9211            
0.0030            0.0366            0.0922            0.3010            0.4888            0.6296            0.8720            1.2036            1.3914            1.5856            2.2238            
0.0060            0.0207            0.1519            0.3393            0.4082            0.5908            0.8038            1.1265            1.3362            1.5696            2.4250            
0.0135            0.0303            0.1014            0.2466            0.3531            0.5108            0.7907            1.0308            1.3495            1.4627            3.2926            
0.0080            0.0186            0.0870            0.2505            0.3955            0.5070            0.6845            0.8720            1.1086            1.4583            1.9078            
0.0130            0.0197            0.1844            0.3112            0.4564            0.5683            0.7595            1.0066            1.0943            1.4110            1.8639            
0.0077            0.0192            0.0834            0.3079            0.4245            0.5158            0.6920            0.8326            1.0422            1.4538            1.5005            
0.0024            0.0350            0.1363            0.2947            0.4146            0.5055            0.6684            0.8831            1.0421            1.2234            1.4461            
0.0272            0.0244            0.0959            0.2736            0.3747            0.5228            0.6818            0.8194            0.9489            1.1061            1.2414            
0.0045            0.0193            0.0750            0.2437            0.3748            0.4854            0.6472            0.7819            0.9727            1.0091            1.2069            
0.0090            0.0174            0.0699            0.2890            0.3960            0.5039            0.6415            0.8480            0.9457            1.0730            1.2800            
0.0100            0.0334            0.1106            0.2860            0.4094            0.5141            0.6125            0.8186            0.9216            0.9763            1.2957            
0.0080            0.0331            0.1763            0.3259            0.4331            0.5280            0.6607            0.8256            0.9987            1.1045            1.4486            
0.0030            0.0318            0.1866            0.2950            0.4101            0.4906            0.5854            0.6102            0.7703            0.7240            1.0394            
0.0100            0.0411            0.1054            0.2691            0.3894            0.4539            0.5154            0.5502            0.6921            0.8579            1.0476            
0.0097            0.0321            0.0991            0.3561            0.3668            0.4572            0.5459            0.6439            0.6412            0.6050            0.9660            
0.0094            0.0208            0.0387            0.2924            0.4179            0.5038            0.5263            0.5661            0.6040            0.6456            0.8557            
0.0050            0.0204            0.0833            0.2384            0.3646            0.4673            0.5413            0.5526            0.6076            0.6555            0.8171            
0.0062            0.0493            0.1442            0.3148            0.4455            0.4756            0.5575            0.5683            0.6013            0.6045            0.9593            
0.0080            0.0445            0.2284            0.3564            0.4410            0.5417            0.5632            0.6530            0.6831            0.7672            0.8247            
0.0110            0.0854            0.2619            0.4181            0.4953            0.5592            0.6210            0.6504            0.7770            0.7196            0.8241            
0.0210            0.0774            0.2197            0.3989            0.5049            0.5996            0.6798            0.7160            0.7376            0.8537            0.8547            
0.0000            0.0460            0.1352            0.3646            0.5063            0.6102            0.6646            0.7846            0.8497            0.8393            1.0102            
0.0209            0.1113            0.1623            0.2621            0.4024            0.4829            0.5783            0.6301            0.7228            0.7841            0.8443 

## Biomass
0.0158            0.0510            0.1077            0.2081            0.2964            0.5614            0.7627            0.9963            1.1490            1.2749            1.8953            
0.0165            0.0569            0.1132            0.2208            0.3437            0.5641            0.7604            0.9002            1.0835            1.2180            1.5509            
0.0132            0.0602            0.1574            0.2209            0.3636            0.4991            0.8643            1.0036            1.0815            1.3243            1.9014            
0.0073            0.0245            0.1459            0.2946            0.3918            0.5290            0.6813            1.0003            1.1870            1.3151            1.6797            
0.0011            0.0247            0.0732            0.2368            0.4450            0.5782            0.7710            0.9884            1.0867            1.3019            1.9579            
0.0113            0.0155            0.0616            0.1835            0.3169            0.5289            0.7308            1.0182            1.2785            1.3736            2.1279            
0.0094            0.0271            0.0898            0.1384            0.2834            0.4409            0.6704            0.9972            1.3195            1.5509            2.1944            
0.0068            0.0270            0.0742            0.1801            0.3062            0.4838            0.7237            0.9938            1.3195            1.6072            2.2838            
0.0106            0.0242            0.0853            0.1927            0.3243            0.5124            0.7324            1.0483            1.2798            1.5958            2.2384            
0.0044            0.0239            0.0689            0.1954            0.3189            0.4477            0.6646            0.8323            1.2774            1.4290            1.9243            
0.0032            0.0185            0.0664            0.1616            0.3062            0.4391            0.5590            0.7695            0.9255            1.3150            1.6959            
0.0014            0.0134            0.0651            0.1929            0.3350            0.5140            0.7183            0.8995            1.0465            1.2950            1.8127            
0.0026            0.0113            0.0564            0.1858            0.3853            0.5663            0.7869            1.0898            1.2352            1.4454            2.0065            
0.0010            0.0138            0.0838            0.2003            0.3837            0.5542            0.8256            1.0626            1.3148            1.4420            2.3134            
0.0015            0.0088            0.0773            0.2803            0.3979            0.5374            0.7049            1.0107            1.2613            1.4089            2.4242            
0.0025            0.0105            0.0573            0.2368            0.4152            0.5471            0.7395            0.9551            1.0913            1.6473            1.9211            
0.0011            0.0149            0.0505            0.1944            0.3816            0.5500            0.7565            1.0415            1.2643            1.3204            2.2238            
0.0027            0.0079            0.0746            0.1769            0.3505            0.5374            0.7114            0.9911            1.2682            1.4778            2.4250            
0.0115            0.0135            0.0458            0.1935            0.3461            0.4566            0.6835            0.9103            1.2330            1.3980            3.2926            
0.0051            0.0158            0.0513            0.1594            0.3123            0.4231            0.5913            0.8304            1.0690            1.4028            1.9078            
0.0107            0.0126            0.0586            0.1645            0.3381            0.4741            0.6205            0.8301            0.9768            1.2507            1.8639            
0.0036            0.0158            0.0405            0.2383            0.3635            0.4852            0.6271            0.7952            1.0242            1.2613            1.5005            
0.0008            0.0164            0.0512            0.1568            0.3573            0.4632            0.5872            0.7817            0.9315            1.1292            1.4461            
0.0323            0.0077            0.0579            0.1931            0.3323            0.4656            0.5871            0.7401            0.9154            1.0736            1.2414            
0.0023            0.0229            0.0428            0.1529            0.3202            0.4265            0.5817            0.7301            0.8928            0.9785            1.2069            
0.0047            0.0088            0.0367            0.1472            0.3107            0.4346            0.5580            0.7408            0.8599            1.0216            1.2800            
0.0055            0.0173            0.0439            0.1414            0.3440            0.4512            0.5556            0.7247            0.8840            0.9609            1.2957            
0.0040            0.0182            0.0767            0.1899            0.3519            0.4649            0.5828            0.7111            0.9042            1.0089            1.4486            
0.0008            0.0159            0.0786            0.2281            0.3656            0.4610            0.5560            0.6349            0.7975            0.8503            1.0394            
0.0056            0.0111            0.0579            0.2241            0.3389            0.4314            0.5028            0.5675            0.6499            0.8129            1.0476            
0.0066            0.0179            0.0638            0.1937            0.3142            0.4219            0.4978            0.5761            0.5940            0.6471            0.9660            
0.0064            0.0142            0.0352            0.1702            0.3858            0.4299            0.4905            0.5559            0.6236            0.6434            0.8557            
0.0016            0.0138            0.0416            0.0961            0.3265            0.4419            0.5222            0.5393            0.5865            0.6292            0.8171            
0.0023            0.0157            0.0542            0.1619            0.3259            0.4164            0.5104            0.5546            0.5764            0.6060            0.9593            
0.0024            0.0166            0.1061            0.2267            0.3726            0.4913            0.5175            0.6034            0.6231            0.6792            0.8247            
0.0041            0.0261            0.1080            0.3090            0.4201            0.4966            0.5800            0.6052            0.7123            0.7011            0.8241            
0.0142            0.0292            0.1370            0.3232            0.4595            0.5450            0.6166            0.6668            0.6926            0.8144            0.8547            
0.0091            0.0311            0.1023            0.2830            0.4494            0.5551            0.6313            0.7303            0.7800            0.7868            1.0102            
0.0091            0.0482            0.0864            0.1882            0.3830            0.4945            0.5940            0.6471            0.7531            0.8162            0.8443            
0.0078            0.0302            0.1079            0.2660            0.4169            0.5165            0.5879            0.6506            0.7122            0.7596            0.8716 

## SSB
0.0158            0.0510            0.1077            0.2081            0.2964            0.5614            0.7627            0.9963            1.1490            1.2749            1.8953            
0.0165            0.0569            0.1132            0.2208            0.3437            0.5641            0.7604            0.9002            1.0835            1.2180            1.5509            
0.0132            0.0602            0.1574            0.2209            0.3636            0.4991            0.8643            1.0036            1.0815            1.3243            1.9014            
0.0073            0.0245            0.1459            0.2946            0.3918            0.5290            0.6813            1.0003            1.1870            1.3151            1.6797            
0.0011            0.0247            0.0732            0.2368            0.4450            0.5782            0.7710            0.9884            1.0867            1.3019            1.9579            
0.0113            0.0155            0.0616            0.1835            0.3169            0.5289            0.7308            1.0182            1.2785            1.3736            2.1279            
0.0094            0.0271            0.0898            0.1384            0.2834            0.4409            0.6704            0.9972            1.3195            1.5509            2.1944            
0.0068            0.0270            0.0742            0.1801            0.3062            0.4838            0.7237            0.9938            1.3195            1.6072            2.2838            
0.0106            0.0242            0.0853            0.1927            0.3243            0.5124            0.7324            1.0483            1.2798            1.5958            2.2384            
0.0044            0.0239            0.0689            0.1954            0.3189            0.4477            0.6646            0.8323            1.2774            1.4290            1.9243            
0.0032            0.0185            0.0664            0.1616            0.3062            0.4391            0.5590            0.7695            0.9255            1.3150            1.6959            
0.0014            0.0134            0.0651            0.1929            0.3350            0.5140            0.7183            0.8995            1.0465            1.2950            1.8127            
0.0026            0.0113            0.0564            0.1858            0.3853            0.5663            0.7869            1.0898            1.2352            1.4454            2.0065            
0.0010            0.0138            0.0838            0.2003            0.3837            0.5542            0.8256            1.0626            1.3148            1.4420            2.3134            
0.0015            0.0088            0.0773            0.2803            0.3979            0.5374            0.7049            1.0107            1.2613            1.4089            2.4242            
0.0025            0.0105            0.0573            0.2368            0.4152            0.5471            0.7395            0.9551            1.0913            1.6473            1.9211            
0.0011            0.0149            0.0505            0.1944            0.3816            0.5500            0.7565            1.0415            1.2643            1.3204            2.2238            
0.0027            0.0079            0.0746            0.1769            0.3505            0.5374            0.7114            0.9911            1.2682            1.4778            2.4250            
0.0115            0.0135            0.0458            0.1935            0.3461            0.4566            0.6835            0.9103            1.2330            1.3980            3.2926            
0.0051            0.0158            0.0513            0.1594            0.3123            0.4231            0.5913            0.8304            1.0690            1.4028            1.9078            
0.0107            0.0126            0.0586            0.1645            0.3381            0.4741            0.6205            0.8301            0.9768            1.2507            1.8639            
0.0036            0.0158            0.0405            0.2383            0.3635            0.4852            0.6271            0.7952            1.0242            1.2613            1.5005            
0.0008            0.0164            0.0512            0.1568            0.3573            0.4632            0.5872            0.7817            0.9315            1.1292            1.4461            
0.0323            0.0077            0.0579            0.1931            0.3323            0.4656            0.5871            0.7401            0.9154            1.0736            1.2414            
0.0023            0.0229            0.0428            0.1529            0.3202            0.4265            0.5817            0.7301            0.8928            0.9785            1.2069            
0.0047            0.0088            0.0367            0.1472            0.3107            0.4346            0.5580            0.7408            0.8599            1.0216            1.2800            
0.0055            0.0173            0.0439            0.1414            0.3440            0.4512            0.5556            0.7247            0.8840            0.9609            1.2957            
0.0040            0.0182            0.0767            0.1899            0.3519            0.4649            0.5828            0.7111            0.9042            1.0089            1.4486            
0.0008            0.0159            0.0786            0.2281            0.3656            0.4610            0.5560            0.6349            0.7975            0.8503            1.0394            
0.0056            0.0111            0.0579            0.2241            0.3389            0.4314            0.5028            0.5675            0.6499            0.8129            1.0476            
0.0066            0.0179            0.0638            0.1937            0.3142            0.4219            0.4978            0.5761            0.5940            0.6471            0.9660            
0.0064            0.0142            0.0352            0.1702            0.3858            0.4299            0.4905            0.5559            0.6236            0.6434            0.8557            
0.0016            0.0138            0.0416            0.0961            0.3265            0.4419            0.5222            0.5393            0.5865            0.6292            0.8171            
0.0023            0.0157            0.0542            0.1619            0.3259            0.4164            0.5104            0.5546            0.5764            0.6060            0.9593            
0.0024            0.0166            0.1061            0.2267            0.3726            0.4913            0.5175            0.6034            0.6231            0.6792            0.8247            
0.0041            0.0261            0.1080            0.3090            0.4201            0.4966            0.5800            0.6052            0.7123            0.7011            0.8241            
0.0142            0.0292            0.1370            0.3232            0.4595            0.5450            0.6166            0.6668            0.6926            0.8144            0.8547            
0.0091            0.0311            0.1023            0.2830            0.4494            0.5551            0.6313            0.7303            0.7800            0.7868            1.0102            
0.0091            0.0482            0.0864            0.1882            0.3830            0.4945            0.5940            0.6471            0.7531            0.8162            0.8443  

## M
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             
0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200             0.200  

## Maturity
0.00              0.02              0.15              0.55              0.90              0.98              1.00              1.00              1.00              1.00              1.00              
0.01              0.05              0.19              0.51              0.82              0.95              0.99              1.00              1.00              1.00              1.00              
0.02              0.06              0.18              0.46              0.76              0.92              0.98              0.99              1.00              1.00              1.00              
0.01              0.05              0.18              0.47              0.78              0.94              0.98              1.00              1.00              1.00              1.00              
0.02              0.08              0.24              0.53              0.80              0.93              0.98              0.99              1.00              1.00              1.00              
0.04              0.12              0.29              0.57              0.81              0.93              0.98              0.99              1.00              1.00              1.00              
0.02              0.07              0.24              0.57              0.85              0.96              0.99              1.00              1.00              1.00              1.00              
0.01              0.05              0.25              0.69              0.94              0.99              1.00              1.00              1.00              1.00              1.00              
0.01              0.04              0.26              0.72              0.95              0.99              1.00              1.00              1.00              1.00              1.00              
0.01              0.04              0.22              0.68              0.94              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.14              0.64              0.95              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.14              0.62              0.94              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.14              0.60              0.93              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.01              0.12              0.58              0.93              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.01              0.12              0.58              0.93              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.01              0.12              0.60              0.94              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.13              0.58              0.93              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.01              0.12              0.59              0.93              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.14              0.60              0.94              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.16              0.58              0.91              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.03              0.17              0.61              0.92              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.17              0.64              0.94              0.99              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.16              0.62              0.93              0.99              1.00              1.00              1.00              1.00              1.00              
0.01              0.03              0.17              0.56              0.89              0.98              1.00              1.00              1.00              1.00              1.00              
0.00              0.02              0.14              0.56              0.91              0.99              1.00              1.00              1.00              1.00              1.00              
0.01              0.04              0.19              0.59              0.90              0.98              1.00              1.00              1.00              1.00              1.00              
0.01              0.04              0.19              0.59              0.90              0.98              1.00              1.00              1.00              1.00              1.00              
0.01              0.06              0.22              0.56              0.85              0.96              0.99              1.00              1.00              1.00              1.00              
0.02              0.07              0.24              0.55              0.83              0.95              0.99              1.00              1.00              1.00              1.00              
0.03              0.09              0.25              0.54              0.80              0.93              0.98              0.99              1.00              1.00              1.00              
0.03              0.09              0.24              0.51              0.77              0.91              0.97              0.99              1.00              1.00              1.00              
0.03              0.10              0.25              0.50              0.76              0.91              0.97              0.99              1.00              1.00              1.00              
0.03              0.09              0.23              0.48              0.74              0.90              0.96              0.99              1.00              1.00              1.00              
0.03              0.10              0.27              0.54              0.79              0.92              0.98              0.99              1.00              1.00              1.00              
0.06              0.16              0.38              0.66              0.86              0.95              0.98              0.99              1.00              1.00              1.00              
0.03              0.13              0.39              0.74              0.93              0.98              1.00              1.00              1.00              1.00              1.00              
0.04              0.14              0.41              0.75              0.93              0.98              1.00              1.00              1.00              1.00              1.00              
0.02              0.10              0.42              0.83              0.97              0.99              1.00              1.00              1.00              1.00              1.00              
0.02              0.13              0.46              0.83              0.97              0.99              1.00              1.00              1.00              1.00              1.00   

## Survey index
spr_ma = Spring Massachusetts survey
ma#aut = Fall Massachusetts survey
spr_us = Spring NEFSC bottom trawl survey
us#aut = Fall NEFSC bottom trawl survey

- 1 column for each age and survey, all in numbers, unsure how 1-JAN tag used
- See "SURVEY INDEX" section of VPA .dat file


## Translate data into format for WHAM
Assume
- Number of years = length of catch at age timeseries (nrow) = 39
- First Year = from PARAM & checked aginst terminal year 2018 = 1980
- Number of Ages = 10
- Number of Fleets = 1 (data doesn't appear to be broken down by gear type)
- Number of Sensitivity Blocks = 1 unchanged ??? revisit
- Number of Available Survey Indices = 4
- Natural Mortality from VPA
- Fecundity Option = 0 unchanged ??? revisit
- Fraction of year that elapses prior to SSB calculation = 0 = Jan-1
- Maturity from VPA
- Number of Weights at Age Matrices = 1
- Weight Matrix - 1 from VPA
- Weights at Age Pointers = unchanged ??? revisit
- Selectivity Block Assignment = unchanged = 1 for Fleet 1 ??? revisit
  - Single selectivity block
- Selectivity Options for each block = 2 = logistic = unchanged ??? revisit
- Selectivity Block # 1 Data? Not sure what each line is ??? revist (currently unchanged but should be updated)
  - Presumably column 1 = data, 2 = phase, 3 = unused setting, 4 = error or variance
- Fleet Start Age = 2 = based on PARTIAL RECRUIT vector in VPA
- Fleet End Age = 10 = based on PARTIAL RECRUIT vector in VPA
- Age Range for Average F = 6 10 = fully selected F based on PARTIAL RECRUIT vector in VPA
- Average F report option = 1 = unewighted = unchanged ??? revisit
- Use Likelihood constants = 0 = unchanged ??? revisit
- Release Mortality by Fleet = 1= unchanged ??? revisit, may not matter since no release data provided
- Catch Data Fleet-1 from VPA
- Discards Fleet-1 no data, placeholder
- Release Proportion Fleet-1 Release no data, placeholder
- Aggregate Index Units = 2 = unchanged, make sure this corresponds with numbers ??? revisit
- Age Proportion Index Units = 2 = unchanged ??? revisit
- Weight at Age Matrix = 1 = unchanged ???, may need to repeat for each index?
- Index Month = 4 10 4 10 = for spring/fall NEFSC, spring/fall MADMF double-check ???
- Index Selectivity Link to Fleet = unchanged -1 ???revisit
- Index Selectiity Options = unchanged 1 = by age ??? revisit
- Index Start Age = 1
- Index End Age = 9, index has 9:11 I am not sure how to specify aggregated 
- Estimate Proportion = unchanged 1 = yes ??? revisit
- Use Index = unchanged 1 = yes ??? revisit
- Index -1 Selectivity data? Not sure what each line is??? revisit (currently unchanged but should be updated)
  - Presumably column 1 = data, 2 = phase, 3 = unused setting, 4 = error or variance
  - Probably need to replicate for other indices
  - Dublicated perfectly for all 4 indices, what do rows correspond to?
- Index-1 Data - unclear how to specify?
  - Presumably year, total aggregated index, variance, age specific observations, effective sample size? check ???
  - Unclear why 9:11 and 9 age columns for NEFSC fall survey? I only included 1-8 and 9:11 columns
  - Used cod default CV & final column
- Phase for F mult in 1st year = 1, unchanged
- Phase for F mult Deviations = 3, unchanged
- Phase for N in 1st year = 1, unchanged
- Phase for Catchability in 1st year = 1, unchanged
- Phase for Catchability deviations = -3, unchanged ??? revisit
- Phase for Stock Recruitment Relationship = 2, unchanged
- Phase for Steepness = -1, unchanged ??? revisit
- Recruitment CV by year = 0.5, unchanged ??? revisit
- Lambdas by Index = 1, unchanged ??? revisit
- Lambda for Total Catch in Weight by Fleet = 1, unchanged ??? revisit
- Lambda for Total Discards at Age by Fleet = 0, unchanged no discards
- Catch Total CV by Year and Fleet = 0.05, unchanged ??? revisit
- Discard Total CV by Year and Fleet = 0, unchanged no discards
- Catch Effective Sample Size by Year and Fleet = 65, unchanged ??? revisit
- Discard Effective Sample Size by Year and Fleet = 0, unchanged no discards
- Lambda for F Mult in First year by Fleet = 0, unchanged ??? revisit
- CV for F Mult in First year by Fleet = 0.1, unchanged ??? revisit
- Lambda for F Mult Deviations by Fleet = 0, unchanged ??? revisit
- CV for F Mult Deviations by Fleet = 0.1, unchanged ??? revisit
- Lambda for N in 1st Year Deviaions = 0, unchanged ??? revisit
- CV for N in 1st Year Deviations = 0.1, unchanged ??? revisit
- Lambda for Recruitment Deviaitons = 0, unchanged ??? revisit
- Lambda for Catchability in First year by Index = 0, unchanged ??? revisit
- CV for Catchability in First year by Index = 0.2, unchanged ??? revisit
- Lambda for Catchability Deviations by Index = 0, unchanged ??? revisit
- CV for Catchability Deviations by Index = 0.1, unchanged ??? revisit
- Lambda for Deviation from Initial Steepness = 0, unchanged ??? revisit
- CV for Deviation from Initial Steepness = 0.1, unchanged ??? revisit
- Lambda for Deviation from Unexploited Stock Size = 0, unchanged ??? revisit
- CV for Deviation from Unexploited Stock Size = 0.1, unchanged ??? revisit
- NAA Deviaitons Flag = 1, unchanged ??? revisit
- Initial Numbers at Age in 1st Year = based on VPA STOCK ASSESSMENT = 100  100  100  2000.  9000.  5000.  5000.  5000.  1000  500  
- Initial F Mult in 1st Year by Fleet = 0.2, unchanged ??? revisit
- Initial Catchability by Index = 1, unchanged ??? revisit
- Stock Recruitment Flag = 0, unchanged ??? revisit
- Initial Unexploited Stock = 10000, unchanged ??? revisit
- Initial Steepness = 1, unchanged??? revisit
- Maximum F = 5, unchanged ??? revisit
- Ignore Guesses = 0, unchanged = no ??? revisit
- Projection control do projections = 0, unchanged
- Fleet Directed Flag = 1, unchanged ??? revisit
- Final Year in Projection = 2018 since not projected, revisit ???
- Projection Data by Year placeholder data unchanged, revisit ???
Exclude MCMC and Agepro arguments from the Cod example

## Read in data for use in WHAM
CANNOT add comments at end of lines (comments must be separate lines)
```{r}
# Load data
asap3 <- read_asap3_dat("Plaice.dat")

# Prep WHAM input
input <- prepare_wham_input(asap3) # Problem reading last column of asap3$IAA_mats?

# Fit plaice model
plaice_model <- fit_wham(input, do.fit = F) # https://timjmiller.github.io/wham/articles/ex7_debug.html
check_convergence(plaice_model)

input <- prepare_wham_input(asap3 = asap3,
                            recruit_model = 2,
                            model_name = "Initial_Plaice",
                            selectivity = list(c("age-specific", "age-specific", "age-specific", "age-specific"),
                                               re = c("none", "none", "none", "none"),
                                               initial_pars = list(c(0.02,0.47,0.88,1,1,1,1,1,1,1,1), c(0.02,0.47,0.88,1,1,1,1,1,1,1,1), c(0.02,0.47,0.88,1,1,1,1,1,1,1,1), c(0.02,0.47,0.88,1,1,1,1,1,1,1,1)),
                                               fix_pars = list(6:9, 6:9, 5, 5:6)),
                            NAA_re = list(sigma="rec", cor="iid"))


asap3 <- read_asap3_dat("Plaice2.dat")
head(asap3)


asap3 <- read_asap3_dat(paste(here::here(), "Gulf_of_Maine_cod_WHAM_example", "codGOM.dat", sep="/"))
input1 <- prepare_wham_input(asap3, recruit_model=2, model_name="GOM Cod",
                             selectivity=list(model=rep("age-specific",2), 
                                              re=rep("none",2), 
                                              initial_pars=list(c(0.013, 0.066, 0.271, 0.663, 0.912, 0.982, 0.997, 1, 1),c(0.038, 0.134, 0.289, 0.531, 0.778, 1, 1, 1, 1)),  
                                              fix_pars=list(7:9,6:9)),
                             NAA_re = list(sigma="rec", cor="iid"))
mcod <- fit_wham(input1, do.osa = F)
check_convergence(mcod)

mcod_proj <- project_wham(model=mcod)
plot_wham_output(mod=mcod, out.type='html')
```

Debugging using source code for read_asap3_dat
```{r}
# filename <- paste(here::here(), "Gulf_of_Maine_cod_WHAM_example", "codGOMcopy.dat", sep="/") # Debug example cod data with additional ages (10-11) and years added(1980-1981)
filename<- "Plaice.dat" # Debug plaice dataset

# Code from source function definition
char.lines <- readLines(filename)
  com.ind <- which(substring(char.lines,1,1) == "#")
  #print(com.ind)
  dat.start <- com.ind[c(which(diff(com.ind)>1), length(com.ind))]
  comments <- char.lines[dat.start]
  #print(comments)
  #print(dat.start)
  #print(length(dat.start))
  dat <- list()
  ind <- 0
  dat$n_years <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$year1 <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$n_ages <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$n_fleets <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  #print(dat)
  #print(ind)
  dat$n_fleet_sel_blocks <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$n_indices <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)

  dat$M <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years*dat$n_ages), dat$n_years, dat$n_ages, byrow = TRUE)
  dat$fec_opt <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$fracyr_spawn <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$maturity <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years*dat$n_ages), dat$n_years, dat$n_ages, byrow = TRUE)
  dat$n_WAA_mats <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$WAA_mats <- lapply(1:dat$n_WAA_mats, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = dat$n_years*dat$n_ages), dat$n_years, dat$n_ages, byrow = TRUE))

  ind <- ind+dat$n_WAA_mats
  npt <- dat$n_fleets * 2 + 2 + 2
  dat$WAA_pointers <- sapply(1:npt, function(x) scan(filename, quiet=T, what = integer(), skip = dat.start[ind+1]+x-1, n = 1))
  ind <- ind + 1
  # print(ind)

  dat$sel_block_assign <- lapply(1:dat$n_fleets, function(x) scan(filename, quiet=T, what = integer(), skip = dat.start[ind+x], n = dat$n_years))
  ind <- ind+dat$n_fleets
  dat$sel_block_option <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_fleet_sel_blocks)
  # print(ind)
  # print(dat.start[ind])
  dat$sel_ini <- lapply(1:dat$n_fleet_sel_blocks, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = 4*(dat$n_ages+6)), dat$n_ages+6, 4, byrow = TRUE))
  ind <- ind + dat$n_fleet_sel_blocks
  dat$fleet_sel_start_age <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$fleet_sel_end_age <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$Frep_ages <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 2)
  dat$Frep_type <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$use_like_const <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$release_mort <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)

  dat$CAA_mats <- lapply(1:dat$n_fleets, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = dat$n_years*(dat$n_ages+1)), dat$n_years, dat$n_ages+1, byrow = TRUE))
  ind <- ind + dat$n_fleets
  dat$DAA_mats <- lapply(1:dat$n_fleets, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = dat$n_years*(dat$n_ages+1)), dat$n_years, dat$n_ages+1, byrow = TRUE))
  ind <- ind + dat$n_fleets
  dat$prop_rel_mats <- lapply(1:dat$n_fleets, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = dat$n_years*(dat$n_ages)), dat$n_years, dat$n_ages, byrow = TRUE))
  ind <- ind + dat$n_fleets
  # print(ind)

  dat$index_units <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_acomp_units <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_WAA_pointers <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_month <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_sel_choice <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_sel_option <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_sel_start_age <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_sel_end_age <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$use_index_acomp <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$use_index <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$index_sel_ini <- lapply(1:dat$n_indices, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = 4*(dat$n_ages+6)), dat$n_ages+6, 4, byrow = TRUE))
  ind <- ind + dat$n_indices
  # print(dat$n_indices)
  #stop()
  # print(dat$index_sel_ini)
  dat$IAA_mats <- lapply(1:dat$n_indices, function(x) matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind+x], n = dat$n_years*(dat$n_ages+4)), dat$n_years, dat$n_ages+4, byrow = TRUE))
  ind <- ind + dat$n_indices
  # print(ind)

  dat$phase_F1 <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_F_devs <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_rec_devs <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_N1_devs <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_q <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_q_devs <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_SR_scalar <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$phase_steepness <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$recruit_cv <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years)

  dat$lambda_index <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$lambda_catch <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$lambda_discard <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)

  dat$catch_cv <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years*dat$n_fleets), dat$n_years, dat$n_fleets, byrow = TRUE)
  dat$discard_cv <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years*dat$n_fleets), dat$n_years, dat$n_fleets, byrow = TRUE)
  dat$catch_Neff <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years*dat$n_fleets), dat$n_years, dat$n_fleets, byrow = TRUE)
  dat$discard_Neff <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_years*dat$n_fleets), dat$n_years, dat$n_fleets, byrow = TRUE)
  # print(ind)

  dat$lambda_F1 <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$cv_F1 <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$lambda_F_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$cv_F_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)

  dat$lambda_N1_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$cv_N1_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$lambda_rec_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)

  dat$lambda_q <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$cv_q <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)

  dat$lambda_q_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$cv_q_devs <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)

  dat$lambda_steepness <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$cv_steepness <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)

  dat$lambda_SR_scalar <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$cv_SR_scalar <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  # print(ind)

  dat$N1_flag <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$N1_ini <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_ages)
  dat$F1_ini <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$q_ini <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = dat$n_indices)
  dat$SR_scalar_type <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$SR_scalar_ini <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$steepness_ini <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$Fmax <- scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$ignore_guesses <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  # print(ind)

  dat$do_proj <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$dir_fleet <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = dat$n_fleets)
  dat$nfinalyear <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  n <- dat$nfinalyear-dat$year1-dat$n_years+1
  # print(n)
  # print(ind)
  # print(dat.start[ind])
  if(n>0) dat$proj_ini <- matrix(scan(filename, quiet=T, what = double(), skip = dat.start[ind <- ind + 1], n = n*5), n, 5, byrow = TRUE)
  else dat$proj_ini <- matrix(nrow = 0, ncol = 5)
  dat$doMCMC <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$MCMC_nyear_opt <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$MCMC_nboot <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$MCMC_nthin <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$MCMC_nseed <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$fill_R_opt <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$R_avg_start <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$R_avg_end <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$make_R_file <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
  dat$testval <- scan(filename, quiet=T, what = integer(), skip = dat.start[ind <- ind + 1], n = 1)
```

Debugging WHAM input using prepare_wham_input source code
```{r}
options(error = function() traceback(3))
prepare_wham_input(asap3, basic_info$n_indices)

test <- read_asap3_dat("Plaice.dat")
test_info = list(n_indices = 4)
prepare_wham_input(test, basic_info = test_info)
asap3 = test
model_name = "Test"
basic_info = NULL
recruit_model = 2
ecov=NULL
selectivity=NULL
M=NULL
NAA_re=NULL
age_comp=NULL

data = list()
	par = list()
	map = list()
	random = character()
  input = list(
  	data = data,
  	par = par,
  	map = map,
  	random = random,
  	years = NULL, years_full = NULL, ages.lab = NULL, model_name = model_name, asap3 = asap3)


  if(is.null(basic_info)){ basic_info = list(recruit_model = recruit_model)} else {basic_info$recruit_model = recruit_model}

  waa_opts = NULL
  waa_names = c("waa")
  if(any(names(basic_info) %in% waa_names)) waa_opts = basic_info[waa_names]

	catch_opts = NULL
  catch_names = c("n_fleets","agg_catch", "catch_paa", "catch_cv","catch_Neff", "use_catch_paa", "selblock_pointer_fleets")
  if(any(names(basic_info) %in% catch_names)) catch_opts = basic_info[catch_names]

  index_opts = NULL
  index_names = c("n_indices", "agg_indices", "agg_index_paa", "fracyr_indices", "index_cv", "index_Neff", "units_indices",
  	"units_index_paa", "use_indices", "use_index_paa", "selblock_pointer_indices")
  if(any(names(basic_info) %in% index_names)) index_opts = basic_info[index_names]

  F_opts = NULL
  F_names = c("F")
  if(any(names(basic_info) %in% F_names)) F_opts = basic_info[F_names]

  waa_opts = NULL
  waa_names = ("waa")
  if(any(names(basic_info) %in% waa_names)) waa_opts = basic_info[waa_names]

  q_opts = NULL
  q_names = c("q","q_lower","q_upper")
  if(any(names(basic_info) %in% q_names)) q_opts = basic_info[q_names]

	if(!is.null(asap3))
	{
	  asap3 = asap3$dat
  	input$asap3 = asap3
	  input$data$n_ages = asap3$n_ages
	  input$data$fracyr_SSB = rep(asap3$fracyr_spawn, asap3$n_years)
	  input$data$mature = asap3$maturity
	  input$data$Fbar_ages = seq(asap3$Frep_ages[1], asap3$Frep_ages[2]) #??? This might be the source of my error
  	input$years <- asap3$year1 + 1:asap3$n_years - 1
	} else
	{
		#if no asap3 is provided, make some default values to
		input = add_basic_info(input, basic_info)
	}

  # print("start")
	#some basic input elements see the function code below
	input = initial_input_fn(input, basic_info)

  # Catch
  input = set_catch(input, catch_opts)
  #print("catch")

  # Indices/surveys
  print(input)
  input = set_indices(input, index_opts)
   #print("indices")

  # WAA in case we want to modify how weight-at age is handled
  input = set_WAA(input, waa_opts)
   #print("WAA")

  # NAA and recruitment options
  input = set_NAA(input, NAA_re)
   #print("NAA")

  input = set_q(input, q_opts)
   #print("q")

  # Selectivity
  input = set_selectivity(input, selectivity)
   #print("selectivity")

  # Age composition model
  input = set_age_comp(input, age_comp)
   #print("age_comp")

  #in case we want to add alternative F options
  input = set_F(input, F_opts)
   #print("F")

 	#set up natural mortality
  input = set_M(input, M)
   #print("M")

	#set up ecov data and parameters. Probably want to make sure to do this after set_NAA.
	input = set_ecov(input, ecov)
   #print("ecov")

  # add vector of all observations for one step ahead residuals ==========================
  input = set_osa_obs(input)
   #print("osa_obs")


  # projection data will always be modified by 'prepare_projection'
  input = set_proj(input, proj.opts = NULL) #proj options are used later after model fit, right?
   #print("proj")

  #set any parameters as random effects
  input = set_map(input)
   #print("map")

  return(input)
  #return(list(data=data, par = par, map = map, random = random, years = model_years, years_full = model_years,
  #  ages.lab = paste0(1:data$n_ages, c(rep("",data$n_ages-1),"+")), model_name = model_name))
}

# function to calcluate reference age for age comp data
#   returns max(age) with non-zero catch for each index/fleet and year
#   -1 if not more than 1 age with non-zero catch (acomp not fit)
get_aref_fn = function(paa){
  n_years = NROW(paa)
  n_ages = NCOL(paa)
  aref = rep(-1, n_years)
  for(y in 1:n_years)
  {
    temp = paa[y,]
    for(a in 1:n_ages) if(temp[a] < 1.0e-15) temp[a] = 0.0
    if (sum(temp > 1.0e-15)>1)
    { #both requirements as well as total catch > 0 to include age comp in objective function
      paa[y,]=temp/sum(temp)
      for(a in 1:n_ages) if(paa[y,a] > 1.0e-15) aref[y] = a
      for(a in n_ages:1)
      {
        if(paa[y,a] > 1.0e-15)
        {
          aref[y] = a #last positive
          break
        }
      }
      #this part is necessary for logistic-normal age comp (type = 5)
      #note the aref can be associated with an observed 0 if needed.
      this_aref = aref[y] - 1 #start one less than last positive
      for(a in this_aref:1)
      {
        if(length(paa[y,a])== 0)
        {
          print(y)
          print(a)
          print(paa[y,])
          print(this_aref)
        }
        if(paa[y,a] > 1.0e-15) break #next to last is positive, don't change aref
        else aref[y] = a #move aref down one.
      }
    }
  }
  return(aref)
}

gen.logit <- function(x, low, upp) return(log((x-low)/(upp-x)))


initial_input_fn = function(input, basic_info){
	#this function is a helper so that this code can be run in other set up functions like change_wham_input
  input$years_full = input$years
  input$ages.lab = paste0(1:input$data$n_ages, c(rep("",input$data$n_ages-1),"+"))
	if(!is.null(basic_info$ages)) {
		if(!is.integer(basic_info$ages) | length(basic_info$ages) != input$data$n_ages){ stop("basic_info$ages has been specified, but it is not an integer vector or it is not = n_ages")
		}else {
  		input$ages.lab = paste0(basic_info$ages, c(rep("",input$data$n_ages-1),"+"))
		}
	}

  input$data$n_years_model = length(input$years)
  input$data$n_years_catch = length(input$years)
  input$data$n_years_indices = length(input$years)
  input$data$recruit_model = basic_info$recruit_model #this is made from argument of the same name to prepare_wham_input
  input$data$which_F_age = rep(input$data$n_ages,input$data$n_years_model) #plus group by default used to define full F and F RP IN projections, only. prepare_projection changes it to properly define selectivity for projections.

  input$data$bias_correct_pe = 1 #bias correct log-normal process errors?
  input$data$bias_correct_oe = 1 #bias correct log-normal observation errors?
  input$data$simulate_state = rep(1,4) #simulate state variables (NAA, M, sel, Ecov)
  input$data$simulate_data = rep(1,3) #simulate data types (catch, indices, Ecov)
  input$data$simulate_period = rep(1,2) #simulate above items for (model years, projection years)
  input$data$percentSPR = 40 #percentage of unfished SSB/R to use for SPR-based reference points
  input$data$percentFXSPR = 100 # percent of F_XSPR to use for calculating catch in projections
  input$data$percentFMSY = 100 # percent of F_XSPR to use for calculating catch in projections
  # data$XSPR_R_opt = 3 #1(3): use annual R estimates(predictions) for annual SSB_XSPR, 2(4): use average R estimates(predictions). See next line for years to average over.
  input$data$XSPR_R_opt = 2 # default = use average R estimates
  input$data$XSPR_R_avg_yrs = 1:input$data$n_years_model - 1 #model year indices (TMB, starts @ 0) to use for averaging recruitment when defining SSB_XSPR (if XSPR_R_opt = 2,4)

  if(!is.null(basic_info$bias_correct_process)) input$data$bias_correct_pe = basic_info$bias_correct_process
  if(!is.null(basic_info$bias_correct_observation)) input$data$bias_correct_oe = basic_info$bias_correct_observation
  if(!is.null(basic_info$simulate_process_error)) input$data$simulate_state = basic_info$simulate_process_error
  if(!is.null(basic_info$simulate_observation_error)) input$data$simulate_data = basic_info$simulate_observation_error
  if(!is.null(basic_info$simulate_period)) input$data$simulate_period = basic_info$simulate_period

  if(!is.null(basic_info$percentSPR)) input$data$percentSPR = basic_info$percentSPR
  if(!is.null(basic_info$percentFXSPR)) input$data$percentFXSPR = basic_info$percentFXSPR
  if(!is.null(basic_info$percentFMSY)) input$data$percentFMSY = basic_info$percentFMSY
  if(!is.null(basic_info$XSPR_R_opt)) input$data$XSPR_R_opt = basic_info$XSPR_R_opt
  if(!is.null(basic_info$XSPR_R_avg_yrs)) input$data$XSPR_R_avg_yrs = basic_info$XSPR_R_avg_yrs}
```

Debug set_indices
```{r}
set_indices(input, index_opts)

# Start function
	data = input$data
	if(is.null(input$asap3)) {
		asap3 = NULL
    if(is.null(index_opts$n_indices)) data$n_indices = 1
    else data$n_indices = index_opts$n_indices
	}else {
  	asap3 = input$asap3
 	  which_indices <- which(asap3$use_index ==1)
	  asap3$n_indices = length(which_indices)
	  asap3$survey_index_units <- asap3$index_units[which_indices]
	  asap3$survey_acomp_units <- asap3$index_acomp_units[which_indices]
	  asap3$survey_WAA_pointers <- asap3$index_WAA_pointers[which_indices]
	  asap3$survey_month <- matrix(asap3$index_month[which_indices], asap3$n_years, asap3$n_indices, byrow = TRUE)
	  asap3$use_survey_acomp <- asap3$use_index_acomp[which_indices]
	  asap3$index_WAA_pointers = asap3$index_WAA_pointers[which_indices]
	  asap3$IAA_mats <- asap3$IAA_mats[which_indices]
	  asap3$use_survey <- asap3$use_index[which_indices]
	  data$n_indices <- asap3$n_indices
	} 
  data$agg_indices = matrix(NA, data$n_years_model, data$n_indices)
  data$use_indices = matrix(1, data$n_years_model, data$n_indices)
  data$agg_index_sigma = matrix(NA, data$n_years_model, data$n_indices)
  data$index_paa = array(NA, dim = c(data$n_indices, data$n_years_model, data$n_ages))
  data$use_index_paa = matrix(1, data$n_years_model, data$n_indices)
  data$index_Neff = matrix(NA, data$n_years_model, data$n_indices)
	if(!is.null(asap3))
	{
	  data$units_indices <- asap3$survey_index_units
	  data$fracyr_indices = (asap3$survey_month-1)/12 #make sure that this is right
  	for(i in 1:data$n_indices) data$agg_indices[,i] = asap3$IAA_mats[[i]][,2]
	  for(i in 1:data$n_indices)
	  {
	    for(y in 1:data$n_years_model) if(asap3$IAA_mats[[i]][y,2] < 1e-15) data$use_indices[y,i] = 0
	  }
	  for(i in 1:data$n_indices) data$agg_index_sigma[,i] = asap3$IAA_mats[[i]][,3]
	  for(i in 1:data$n_indices)
	  {
	    temp = asap3$IAA_mats[[i]][,3 + 1:data$n_ages]
	    temp[which(is.na(temp))] = 0
	    temp[which(temp<0)] = 0
	    data$index_paa[i,,] = temp/apply(temp,1,sum)
	  }
	  for(i in 1:data$n_indices)
	  {
	    if(asap3$use_survey_acomp[i] != 1){ data$use_index_paa[,i] = 0
	    }else for(y in 1:data$n_years_model) if(asap3$IAA_mats[[i]][y,4 + data$n_ages] < 1e-15 | sum(data$index_paa[i,y,] > 1e-15)<2) data$use_index_paa[y,i] = 0
	  }
	  data$units_index_paa <- asap3$survey_acomp_units
	  for(i in 1:data$n_indices) data$index_Neff[,i] = asap3$IAA_mats[[i]][,4 + data$n_ages]

    data$selblock_pointer_indices = matrix(rep(asap3$n_fleet_sel_blocks + 1:data$n_indices, each = data$n_years_model), data$n_years_model, data$n_indices)
	}
	else
	{
		if(is.null(index_opts$units_indices)) data$units_indices = rep(1,data$n_indices) #biomass
		else data$units_indices = index_opts$units_indices
		
		if(is.null(index_opts$fracyr_indices)) data$fracyr_indices =matrix(0.5, data$n_years_model, data$n_indices)
		else data$fracyr_indices = index_opts$fracyr_indices
		
		if(is.null(index_opts$agg_indices)) data$agg_indices[] = 10
		else data$agg_indices[] = index_opts$agg_indices

		if(is.null(index_opts$index_cv)) data$agg_index_sigma[] = 0.3
		else data$agg_index_sigma[] = index_opts$index_cv

		if(is.null(index_opts$index_paa)) data$index_paa[] = 1/data$n_ages
		else data$index_paa[] = index_opts$index_paa

		if(is.null(index_opts$units_index_paa)) data$units_index_paa = rep(2,data$n_indices) #numbers
		else data$units_index_paa = index_opts$units_index_paa

		if(is.null(index_opts$index_Neff)) data$index_Neff[] = 100
		else data$index_Neff[] = index_opts$index_Neff

    if(is.null(index_opts$selblock_pointer_indices)) data$selblock_pointer_indices = matrix(rep(1:data$n_indices, each = data$n_years_model), data$n_years_model, data$n_indices) + data$n_fleets
    else data$selblock_pointer_indices = index_opts$selblock_pointer_indices
	}

  data$agg_index_sigma[which(data$agg_index_sigma < 1e-15)] = 100  
  data$agg_index_sigma = sqrt(log(data$agg_index_sigma^2 + 1))
  # for plotting, in years where index is not used set sigma = avg of used years
  tmp <- data$agg_index_sigma
  tmp[data$use_indices == 0] = NA
  mean_agg_ind_sigma <- apply(tmp, 2, mean, na.rm=T)
  for(i in 1:data$n_indices) data$agg_index_sigma[data$use_indices[,i] == 0,i] = mean_agg_ind_sigma[i]
  ################################################################################

  data$index_paa[is.na(data$index_paa)] = 0
  data$index_aref = matrix(NA, data$n_years_model, data$n_indices)
  for(i in 1:data$n_indices) data$index_aref[,i] = get_aref_fn(data$index_paa[i,,])  

  input$par$log_index_sig_scale = rep(0, data$n_indices)
  input$map$log_index_sig_scale = factor(rep(NA, data$n_indices))

	
  input$data = data
  return(input)
# End function


```


