---
title: "Model_Comparison"
output: html_document
date: '2022-02-24'
---

This script reads in fitted WHAM model outputs for runs based on revised data (estimated rather than imputed discards) and generates comparison plots.

Models 12, 18, and 20 did not have invertible hessians so they are not included in the following comparisons. Model 21 did not converge so it is also not included here.

### Compare all model with 1 selectivity block or random effects for selectivity
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds",
                     "WHAM_Run12_FreeSelectivity-at-age/WHAM_Run12_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9:14), sep="")

# Generate comparative diagnostics
wham::compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
# Compare models with two fishery selectivity blocks
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",                 "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds", "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds", "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(16, 17, 19, 22), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare all model with random effects for selectivity
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(23, 24), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

# Calculate diagnostic table for all models
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds",
                     #"WHAM_Run12_FreeSelectivity-at-age/WHAM_Run12_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds",
                     "WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds", "WHAM_Run16A_2SelBlock_logisticSel/WHAM_Run16A_model.rds",
                     "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds",
                     "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds", "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds", "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run23A_SelRandEffect-iidFleetOnly/WHAM_Run23A_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds", "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds", "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds", 
                     "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds", 
                     "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
                     "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds",
                     "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds", 
                     "WHAM_Run37_VAST_ALL/WHAM_Run37_model.rds",
                     "WHAM_Run37A_VAST_ALL-randSel/WHAM_Run37A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9, 10,11, 13,14,16, "16A",17,19,22, 23, "23A", 24, 25, 26, 27, 28:35, 37, "37A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = FALSE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
# Summary diagnostics for all except 10/11 (old data), 12 not invertible, 15 not working, 18/20/21 not invertible or not converged
```{r}
modelRuns <- modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds",
                     "WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",
                     "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds",
                     "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds", 
                     "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds",
                     "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds",
                     "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
                     "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds", 
                     "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
                     "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds",
                     "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9,13,14,16,17,19,22,23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=FALSE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 1)) # Summary plots 1, 2, 8, 9
```

# Compare impact of updating M and maturity expectations (scaling runs)
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9,10, 11), sep="")
# names(models) <- c("All-updated", "VPA-M", "VPA-M-and-Mat")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare all model with random effects for selectivity
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds", "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(16, 23), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"),  plot.opts=list(which = 1)) #  compared plots 1,2,5,6,7,8,9,10
```

### Compare dome vs. logistic selectivity (Runs 16 and 16A)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",
                     "WHAM_Run16A_2SelBlock_logisticSel/WHAM_Run16A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(16, "16A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

### Compare selectivity iid random effect application (Runs 23 and 23A)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run23A_SelRandEffect-iidFleetOnly/WHAM_Run23A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(23, "23A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

### Compare recruitment runs (25-27) with Run 23
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                    "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
                    "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(23, 25:27), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

### Compare run 25 (R rand effect iid) and 28 (longer timeseries)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds", "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 28), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 8)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

### Compare run 25 (R rand effect iid) and 27 (full state-space)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds", "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 27), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 1)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

### Compare run 27 (full NAA random effect) and 29 (NEFSC split into Albatross/Bigelow years)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 29), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 1)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

### Compare full NAA random effect (run 27) with models that add in other survey indices 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds",
  "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
  "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds", "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 30, 31, 32, 33, 34, 35), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 9)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare full NAA random effect (run 27), R random effect (run 25) and models that add individual indices
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
  "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 27, 30, 31, 32), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 8)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare runs with MADMF and MENH to run 27 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
  "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 30, 31, 33), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 8)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare runs with LPUE indices to run 25
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
  "WHAM_Run32_addLPUE/WHAM_Run32_model.rds",
  "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds", "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 32, 34, 35), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = 1)) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```


### Compare VAST runs with/out sel random effects
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run37_VAST_ALL/WHAM_Run37_model.rds",
                     "WHAM_Run37A_VAST_ALL-randSel/WHAM_Run37A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(37, "37A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```
