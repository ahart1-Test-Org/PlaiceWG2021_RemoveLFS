
---
title: "Model_Comparison"
output: html_document
date: '2022-02-24'
---

This script reads in fitted WHAM model outputs for runs based on revised data (estimated rather than imputed discards) and generates comparison plots.

Models 12, 18, and 20 did not have invertible hessians so they are not included in the following comparisons. Model 21 did not converge so it is also not included here.

### Compare all model with 1 selectivity block or random effects for selectivity
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds",
                     "WHAM_Run12_FreeSelectivity-at-age/WHAM_Run12_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9:14), sep="")

# Generate comparative diagnostics
wham::compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
# Compare models with two fishery selectivity blocks
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",                 "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds", "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds", "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(16, 17, 19, 22), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare all model with random effects for selectivity
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(23, 24), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

# Calculate diagnostic table for all models
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds",
                     #"WHAM_Run12_FreeSelectivity-at-age/WHAM_Run12_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds",
                     "WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",
                     "WHAM_Run16A_2SelBlock_logisticSel/WHAM_Run16A_model.rds",
                     "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds",
                     "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds", 
                     "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds",
                     "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run23A_SelRandEffect-iidFleetOnly/WHAM_Run23A_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds",
                     "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
                     "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds", 
                     "WHAM_Run27A_Full-State-Space_biomassUnit/WHAM_Run27A_model.rds",
                     "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
                     "WHAM_Run29A_splitNEFSC-BigUnits/WHAM_Run29A_model.rds",
                     "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
                     "WHAM_Run29B-1_changeESS/WHAM_Run29B-1_model.rds",
                     "WHAM_Run29C_splitNEFSC-biomass/WHAM_Run29C_model.rds",
                     #"WHAM_Run29DE_splitNEFSC-FreeSel-nlAgeComp/WHAM_Run29E_ln_acomp_model.rds", # Run 29D was exploratory so not included here
                     "WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
                     "WHAM_Run29F-1_swapInitSel/WHAM_Run29F-1_model.rds",
                     "WHAM_Run29F-2_swapInitSel-randAlbFall/WHAM_Run29F-2_model.rds",
                     "WHAM_Run29F-3_swapInitSel-fixAlbFall/WHAM_Run29F-3_model.rds",
                     "WHAM_Run29F-4_splitNEFSC-BigUnits-nlAgeComp-fix1/WHAM_Run29F4_model.rds",
                     "WHAM_Run29H_splitNEFSC-BigUnits-dirmultAgeComp/WHAM_Run29H_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds", 
                     "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
                     "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds",
                     "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds", 
                     "WHAM_Run37_VAST_ALL/WHAM_Run37_model.rds",
                     "WHAM_Run37A_VAST_ALL-randSel/WHAM_Run37A_model.rds", 
                     "WHAM_Run37B_VAST_ALL-split/WHAM_Run37B_model.rds", 
                     "WHAM_Run37C_VAST_ALL-split-noRand/WHAM_Run37C_model.rds",
                     "WHAM_Run37E_VAST-BigUnit-randSel/WHAM_Run37E_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9, 10,11, 13,14,16, "16A",17,19,22, 23, "23A", 24, 25, 26, 27, "27A", 28, 29, "29A", "29B", "29B-1", "29C",  "29F", "29F-1", "29F-2", "29F-3", "29F-4", "29H", 30, 31, 32, 33, 34, 35, 37, "37A", "37B", "37C", "37E"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = FALSE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
AIC for run 32A
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run32_addLPUE/WHAM_Run32_model.rds", 
                     "WHAM_Run32A_addLPUE_qRand/WHAM_Run32A_model.rds"), sep="/")


# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(32, "32A"), sep="")
Run32A <- models$Run32A

# Calculate AIC
          k = length(Run32A$opt$par)
 aic <-   2*(Run32A$opt$obj + k) # AIC
        aic <- round(aic, 1)
      
      aic.tab <- cbind(aic)
      colnames(aic.tab) <- c("AIC")
```
AIC for R-env runs BT temp FVCOM
```{r}
modelRuns2 <- paste(here::here(), "WG_Revised_Runs", c(                     "WHAM_Run38_addEnvCov-BT-noEffect/WHAM_Run38_model.rds"), sep="/")
                     # "WHAM_Run38A_addEnvCov-BT-withEffect/WHAM_Run38A_model.rds",
                     # "WHAM_Run38B_addEnvCov-BT-withEffect-2lag/WHAM_Run38B_model.rds"), sep="/")
models2 <- lapply(modelRuns2, readRDS)
names(models2) <- paste("Run", c(38))
compare_wham_models(models2, do.plot = FALSE, do.table = TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
AIC for R-env runs SST anomaly
```{r}
modelRuns3 <- paste(here::here(), "WG_Revised_Runs",              c("WHAM_Run39_addEnvCov-anomSST-noEffect/WHAM_Run39_model.rds",
                     "WHAM_Run39A_addEnvCov-anomSST-withEffect/WHAM_Run39A_model.rds"), sep="/")

models3 <- lapply(modelRuns3, readRDS)
names(models3) <- paste("Run", c(39, "39A"))
compare_wham_models(models3, do.plot = FALSE, do.table = TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
AIC for q-env runs SST anomaly
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",              c("WHAM_Run41_addEnvCov-q-anomBT-noEffect/WHAM_Run41_model.rds",
                     "WHAM_Run41A_addEnvCov-q-anomBT-withEffect/WHAM_Run41A_model.rds"), sep="/")

models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(41, "41A"))
compare_wham_models(models, do.plot = FALSE, do.table = TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
AIC for R-env runs  NAO
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",              c("WHAM_Run42_addEnvCov-R-NAO-noEffect/WHAM_Run42_model.rds", 
       "WHAM_Run42A_addEnvCov-R-NAO-withEffect/WHAM_Run42A_model.rds"), sep="/")

# 42B calculated below

models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(42, "42A"))
compare_wham_models(models, do.plot = FALSE, do.table = TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
AIC for run 42B
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run38B_addEnvCov-BT-withEffect-2lag/WHAM_Run38B_model.rds",
                                                      "WHAM_Run42B_addEnvCov-R-NAO-withEffect-2Lag/WHAM_Run42B_model.rds"), sep="/")


# Read in model Rdata
models <- lapply(modelRuns, readRDS)
Run42B <- models$Run42B

# Calculate AIC
          k = length(Run42B$opt$par)
 aic <-   2*(Run42B$opt$obj + k) # AIC
        aic <- round(aic, 1)
      
      aic.tab <- cbind(aic)
      colnames(aic.tab) <- c("AIC")
    
      rho <- mohns_rho(Run42B)[c("R","SSB","Fbar")]
      rho <- round(rho, 4)
      names(rho) <- paste0("rho_",c("R","SSB","Fbar"))
      # apply(rho, 1, function(y) mean(abs(y)))
    
    tab <- c(aic.tab, as.matrix(rho, nrow=1))
```
AIC for R-env runs  AMO
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",              c("WHAM_Run43_addEnvCov-R-AMO-noEffect/WHAM_Run43_model.rds", 
       "WHAM_Run43A_addEnvCov-R-AMO-withEffect/WHAM_Run43A_model.rds"), sep="/")

# 42B calculated below

models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(42, "42A"))
compare_wham_models(models, do.plot = FALSE, do.table = TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
AIC for R-env runs BT anomaly
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",              c("WHAM_Run44_addEnvCov-R-anomBT-noEffect/WHAM_Run44_model.rds", 
       "WHAM_Run44A_addEnvCov-R-anomBT-withEffect/WHAM_Run44A_model.rds"), sep="/")

# 42B calculated below

models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(44, "44A"))
compare_wham_models(models, do.plot = FALSE, do.table = TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

# Summary diagnostics for all except 10/11 (old data), 12 not invertible, 15 not working, 18/20/21 not invertible or not converged, 36 not converged with all indices
```{r}
modelRuns <- modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds",
                     "WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",
                     "WHAM_Run16A_2SelBlock_logisticSel/WHAM_Run16A_model.rds",
                     "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds",
                     "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds", 
                     "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds",
                     "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run23A_SelRandEffect-iidFleetOnly/WHAM_Run23A_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds",
                     "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
                     "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
                     "WHAM_Run29A_splitNEFSC-BigUnits/WHAM_Run29A_model.rds",
                     "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
                     "WHAM_Run29C_splitNEFSC-biomass/WHAM_Run29C_model.rds",
                     "WHAM_Run29DE_splitNEFSC-FreeSel-nlAgeComp/WHAM_Run29E_ln_acomp_model.rds", # Run 29D was exploratory so not included here
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds", 
                     "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
                     "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds",
                     "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds", 
                     "WHAM_Run37_VAST_ALL/WHAM_Run37_model.rds",
                     "WHAM_Run37A_VAST_ALL-randSel/WHAM_Run37A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9,13,14,16, "16A", 17,19,22,23, "23A", 24, 25, 26, 27, 28, 29,"29A", "29B", "29C", "29E", 30, 31, 32, 33, 34, 35, 37, "37A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=FALSE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,8,9))) # Summary plots 1, 2, 8, 9
```

# Compare impact of updating M and maturity expectations (scaling runs)
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9,10, 11), sep="")
# names(models) <- c("All-updated", "VPA-M", "VPA-M-and-Mat")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare all model with random effects for selectivity
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds", "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(16, 23), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"),  plot.opts=list(which = c(1,2,5,6,7,8,9,10))) #  compared plots 1,2,5,6,7,8,9,10
```

### Compare dome vs. logistic selectivity (Runs 16 and 16A)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",
                     "WHAM_Run16A_2SelBlock_logisticSel/WHAM_Run16A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(16, "16A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

### Compare selectivity iid random effect application (Runs 23 and 23A)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run23A_SelRandEffect-iidFleetOnly/WHAM_Run23A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(23, "23A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

### Compare recruitment runs (25-27) with Run 23
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                    "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
                    "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(23, 25:27), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot
```

### Compare run 25 (R rand effect iid) and 28 (longer timeseries)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds", "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 28), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

### Compare run 25 (R rand effect iid) and 27 (full state-space)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds", "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 27), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

### Compare run 27 (full NAA random effect) and 29A-C,F (NEFSC split into Albatross/Bigelow years)
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds","WHAM_Run29A_splitNEFSC-BigUnits/WHAM_Run29A_model.rds",
                     "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
                     "WHAM_Run29C_splitNEFSC-biomass/WHAM_Run29C_model.rds",
  "WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds"), sep="/")
                     # "WHAM_Run29DE_splitNEFSC-FreeSel-nlAgeComp/WHAM_Run29E_ln_acomp_model.rds" # Run 29D was exploratory so not included here

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 29, "29A", "29B", "29C", "29F"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10 (mostly 1,2,8)
```

#### Compare run 29B and 29F (NEFSC split with multinomial and logistic-normal age comp likelihoods respectively) 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
  "WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("29B", "29F"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare run 27, 29, 29B, 29F 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
  "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
  "WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
  "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds"), sep="/") # ,
#   "Compare_ASAP_Run46B/Compare_ASAP_Run46B_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 29, "29F", "29B"), sep="") # , "ASAP46B"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10 (mostly 1,2,8)
```

#### Compare run 27, 29, 29B, 29B-1 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
  "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
  "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
  "WHAM_Run29B-1_changeESS/WHAM_Run29B-1_model.rds"), sep="/") 

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 29, "29B", "29B-1"), sep="") 

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10 (mostly 1,2,8)
```

#### Compare run 29, 29B
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
  "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds"), sep="/") 

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(29,"29B"), sep="") 

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10 (mostly 1,2,8)
```

### Compare run 29Fs
Compare 29F and 29F-1
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
  "WHAM_Run29F-1_swapInitSel/WHAM_Run29F-1_model.rds"), sep="/") 

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("29F","29F-1"), sep="") 

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) 
```
Compare 29F and 29F-2
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
  "WHAM_Run29F-2_swapInitSel-randAlbFall/WHAM_Run29F-2_model.rds"), sep="/") 

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("29F","29F-2"), sep="") 

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) 
```
Compare 29F and 29F-3
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
  "WHAM_Run29F-3_swapInitSel-fixAlbFall/WHAM_Run29F-3_model.rds"), sep="/") 

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("29F","29F-3"), sep="") 

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) 
```
Compare 29F, 29F-2 and 29F-4
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
  "WHAM_Run29F-2_swapInitSel-randAlbFall/WHAM_Run29F-2_model.rds",
  "WHAM_Run29F-4_splitNEFSC-BigUnits-nlAgeComp-fix1/WHAM_Run29F4_model.rds"), sep="/") 

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("29F","29F-2", "29F-4"), sep="") 

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) 
```

### Compare full NAA random effect (run 27) with models that add in other survey indices 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds",
  "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
  "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds", "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 30, 31, 32, 33, 34, 35), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare full NAA random effect (run 27), R random effect (run 25) and models that add individual indices
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
  "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 27, 30, 31, 32), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare runs with MADMF and MENH to run 27 
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
  "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(27, 30, 31, 33), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

#### Compare runs with LPUE indices to run 25
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
  "WHAM_Run32_addLPUE/WHAM_Run32_model.rds",
  "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds", "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(25, 32, 34, 35), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), plot.opts=list(which = c(1,2,6,7,8,9,10))) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```


### Compare VAST runs with/out sel random effects
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs",
c("WHAM_Run37_VAST_ALL/WHAM_Run37_model.rds",
                     "WHAM_Run37A_VAST_ALL-randSel/WHAM_Run37A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(37, "37A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/")) # plot.opts=list(which = 1) argument generates only the first plot - here looked at plots 1,2,6,7,8,9,10
```

### Compare Runs 38: with BT link to R
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c(#"WHAM_Run38_addEnvCov-BT-noEffect/WHAM_Run38_model.rds", 
                                                      "WHAM_Run38A_addEnvCov-BT-withEffect/WHAM_Run38A_model.rds",
                                                      "WHAM_Run38B_addEnvCov-BT-withEffect-2lag/WHAM_Run38B_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("38A", "38B"), sep="")

# Generate comparative diagnostics
compare_wham_models(list(Run38A, Run38B), do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"), calc.aic = FALSE)
```


### Compare Runs 39: with SST anomaly link to R
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run39_addEnvCov-anomSST-noEffect/WHAM_Run39_model.rds", 
                                                      "WHAM_Run39A_addEnvCov-anomSST-withEffect/WHAM_Run39A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(39, "39A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```
Compare to run 29B
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run39_addEnvCov-anomSST-noEffect/WHAM_Run39_model.rds", 
                                                      "WHAM_Run39A_addEnvCov-anomSST-withEffect/WHAM_Run39A_model.rds",
                                                      "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(39, "39A", "29B"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=FALSE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare Runs 42: with NAO anomaly link to R
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run42_addEnvCov-R-NAO-noEffect/WHAM_Run42_model.rds", 
                                                      "WHAM_Run42A_addEnvCov-R-NAO-withEffect/WHAM_Run42A_model.rds"), sep="/")
                                                      # "WHAM_Run42B_addEnvCov-R-NAO-withEffect-2Lag/WHAM_Run42B_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(42, "42A"),sep="") #42B"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))

```
Compare to 42B without AIC and table
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run42_addEnvCov-R-NAO-noEffect/WHAM_Run42_model.rds", 
                                                      "WHAM_Run42A_addEnvCov-R-NAO-withEffect/WHAM_Run42A_model.rds",
                                                      "WHAM_Run42B_addEnvCov-R-NAO-withEffect-2Lag/WHAM_Run42B_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(42, "42A", "42B"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=FALSE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare Runs 43: with AMO link to R
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run43_addEnvCov-R-AMO-noEffect/WHAM_Run43_model.rds", 
                                                      "WHAM_Run43A_addEnvCov-R-AMO-withEffect/WHAM_Run43A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(43, "43A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare Runs 44: with BT anomaly link to R
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run44_addEnvCov-R-anomBT-noEffect/WHAM_Run44_model.rds", 
                                                      "WHAM_Run44A_addEnvCov-R-anomBT-withEffect/WHAM_Run44A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(44, "44A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare Runs 41: with BT anomaly link to catchability
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run41_addEnvCov-q-anomBT-noEffect/WHAM_Run41_model.rds", 
                                                      "WHAM_Run41A_addEnvCov-q-anomBT-withEffect/WHAM_Run41A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(41, "41A"), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=TRUE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

### Compare Runs 29B,39,41,42,43 - runs like 29B but fit to another env data set with no effect
```{r}
# File path
modelRuns <- paste(here::here(), "WG_Revised_Runs", c("WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
                                                      "WHAM_Run39_addEnvCov-anomSST-noEffect/WHAM_Run39_model.rds",
                                                      "WHAM_Run41_addEnvCov-q-anomBT-noEffect/WHAM_Run41_model.rds",
                                                      "WHAM_Run42_addEnvCov-R-NAO-noEffect/WHAM_Run42_model.rds",
  "WHAM_Run43_addEnvCov-R-AMO-noEffect/WHAM_Run43_model.rds","WHAM_Run44_addEnvCov-R-anomBT-noEffect/WHAM_Run44_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c("29B", 39, 41, 42, 43,44), sep="")

# Generate comparative diagnostics
compare_wham_models(models, do.plot = TRUE, do.table=FALSE, fdir=paste(here::here(), "WG_Revised_Runs", "Comparison_Output", sep="/"))
```

# Read in individuals
```{r}
modelRuns <- paste(here::here(), "WG_Revised_Runs",
                   c("WHAM_Run9_RevisedData-M-Maturity/WHAM_Run9_model.rds",
                     "WHAM_Run10_RevisedData-Maturity/WHAM_Run10_model.rds",
                     "WHAM_Run11_RevisedData/WHAM_Run11_model.rds",
                     #"WHAM_Run12_FreeSelectivity-at-age/WHAM_Run12_model.rds",
                     "WHAM_Run13_FixSelectivity-at-age/WHAM_Run13_model.rds",
                     "WHAM_Run14_Index2Sel-logistic/WHAM_Run14_model.rds",
                     "WHAM_Run16_FixSelectivity-at-age_2SelBlock/WHAM_Run16_model.rds",
                     "WHAM_Run16A_2SelBlock_logisticSel/WHAM_Run16A_model.rds",
                     "WHAM_Run17_2SelBlock_Rrand-mean/WHAM_Run17_model.rds",
                     "WHAM_Run19_2SelBlock_logistic-normal-agecomp_Index2Sel-logistic/WHAM_Run19_model.rds",
                     "WHAM_Run22_2SelBlock_changeESS/WHAM_Run22_model.rds",
                     "WHAM_Run23_SelRandEffect-iid/WHAM_Run23_model.rds",
                     "WHAM_Run23A_SelRandEffect-iidFleetOnly/WHAM_Run23A_model.rds",
                     "WHAM_Run24_SelRandEffect-ar1_y/WHAM_Run24_model.rds",
                     "WHAM_Run25_RRandEffect-randMean/WHAM_Run25_model.rds",
                     "WHAM_Run26_RRandEffect-ar1_y/WHAM_Run26_model.rds",
                     "WHAM_Run27_Full-State-Space/WHAM_Run27_model.rds", 
                     "WHAM_Run28_Extended-Catch1960/WHAM_Run28_model.rds",
                     "WHAM_Run29_splitNEFSC/WHAM_Run29_model.rds",
                     "WHAM_Run29A_splitNEFSC-BigUnits/WHAM_Run29A_model.rds",
                     "WHAM_Run29B_splitNEFSC-BigUnits-noSurvRandSel/WHAM_Run29B_model.rds",
                     "WHAM_Run29C_splitNEFSC-biomass/WHAM_Run29C_model.rds",
                     "WHAM_Run29F_splitNEFSC-BigUnits-nlAgeComp/WHAM_Run29F_model.rds",
                     "WHAM_Run29F-1_swapInitSel/WHAM_Run29F-1_model.rds",
                     "WHAM_Run29F-2_swapInitSel-randAlbFall/WHAM_Run29F-2_model.rds",
                     "WHAM_Run29F-3_swapInitSel-fixAlbFall/WHAM_Run29F-3_model.rds",
                     "WHAM_Run30_addMADMF/WHAM_Run30_model.rds",
                     "WHAM_Run31_addMENH/WHAM_Run31_model.rds",
                     "WHAM_Run32_addLPUE/WHAM_Run32_model.rds", 
                     "WHAM_Run33_addMADMF-MENH/WHAM_Run33_model.rds",
                     "WHAM_Run34_addMENH-LPUE/WHAM_Run34_model.rds",
                     "WHAM_Run35_addMADMF-LPUE/WHAM_Run35_model.rds", 
                     "WHAM_Run37_VAST_ALL/WHAM_Run37_model.rds",
                     "WHAM_Run37A_VAST_ALL-randSel/WHAM_Run37A_model.rds",
                     "WHAM_Run38_addEnvCov-BT-noEffect/WHAM_Run38_model.rds",
                     # "WHAM_Run38A_addEnvCov-BT-withEffect/WHAM_Run38A_model.rds",
                     # "WHAM_Run38B_addEnvCov-BT-withEffect-2lag/WHAM_Run38B_model.rds",
                     "WHAM_Run39_addEnvCov-anomSST-noEffect/WHAM_Run39_model.rds",
                     "WHAM_Run39A_addEnvCov-anomSST-withEffect/WHAM_Run39A_model.rds"), sep="/")
                     # "WHAM_Run41_addEnvCov-q-anomBT-noEffect/WHAM_Run41_model.rds",
                     # "WHAM_Run41A_addEnvCov-q-anomBT-withEffect/WHAM_Run41A_model.rds"), sep="/")

# Read in model Rdata
models <- lapply(modelRuns, readRDS)
names(models) <- paste("Run", c(9, 10,11, 13,14,16, "16A",17,19,22, 23, "23A", 24, 25, 26, 27, 28, 29, "29A", "29B", "29C", "29F", "29F1", "29F2", "29F3", 30:35, 37, "37A", 38, 39, "39A"), sep="")

check_convergence(models$Run26)
print(paste("Number of parameters", length(models$Run26$par), sep=" "))
```


